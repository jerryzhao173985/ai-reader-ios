{
  "memories": [
    {
      "type": "preference",
      "content": "Build/test on physical iPhone 15 Pro Max via WiFi (Device ID: 00008130-001659882E43001C). User prefers fundamentally correct, complete code that addresses root causes - not minimal changes or overkill complexity. Defensive correctness valued over brevity when it aids maintainer understanding.",
      "added_at": "2026-01-22T10:00:00.000000"
    },
    {
      "type": "completed_feature",
      "content": "AIReaderApp: iOS EPUB reader with SwiftUI, SwiftData, WKWebView. Features: Library, TOC, reading progress, text highlights with AI analysis (fact-check, discussion, key points, argument map, counterpoints, custom questions), inline markers [1][2][3], delete highlight + undo (flicker-free via JS injection), haptic feedback, brain icon chapter highlights list, cross-chapter analysis persistence. Thread-per-analysis architecture: each analysis type has its own independent conversation thread with follow-ups. GitHub: https://github.com/jerryzhao173985/ai-reader-ios",
      "added_at": "2026-01-22T18:30:00.000000"
    },
    {
      "type": "technical",
      "content": "SwiftData architecture: book.highlights = ALL highlights (book-scoped), currentChapterHighlights = filtered for current chapter. AIAnalysisModel.prompt/response = initial Q&A; AIAnalysisModel.thread.turns = follow-ups only. selectedAnalysis tracks current analysis for conversation display. Thread-per-analysis: Fact Check, Discussion, Custom Q each have independent threads - follow-ups append to the viewed analysis's thread.",
      "added_at": "2026-01-22T18:30:00.000000"
    },
    {
      "type": "technical",
      "content": "WKWebView scroll/flicker prevention: JS injection for marker/color/undo updates (not loadHTMLString). Dual hash tracking (baseContentHash, styledContentHash). Selection preservation via hasActiveTextSelection + pendingMarkerUpdatesQueue. goToChapter() MUST clear hasActiveTextSelection first to ensure cross-chapter analysis uses immediate update path.",
      "added_at": "2026-01-22T15:20:00.000000"
    },
    {
      "type": "decision",
      "content": "State Management Patterns: (1) Two Distinct Actions: performAnalysis() clears selectedAnalysis=nil for clean loading view; askFollowUpQuestion() captures analysisToFollowUp=selectedAnalysis at function START before any async work. (2) State Symmetry: All deselection paths (X button, goToChapter, deleteHighlight) must clear full state set: selectedHighlight, selectedText, analysisResult, currentAnalysisType, selectedAnalysis, isAnalyzing, customQuestion. (3) Race Condition Guards: highlightToJobMap tracks ONE active job per highlight; isActiveJob = map[highlightId] == jobId; guards UI updates ONLY, not data persistence. (4) Job Cleanup Ownership: map removal must check map[highlightId] == jobId to prevent earlier job from orphaning later job's entry. (5) Duplicate Prevention: Use content-based detection (question+answer match) in addTurnToThread(), not job ordering. (6) Principle: User intent trumps background job completion - never overwrite explicit user selection.",
      "added_at": "2026-01-23T08:00:00.000000"
    }
  ],
  "manual_memories": [],
  "realtime_memories": [
    {
      "type": "claude_response",
      "content": "Consolidated: 11 â†’ 5 memories. Cleared debug session fragments, updated decision memory with duplicate prevention pattern.",
      "added_at": "2026-01-23T08:02:05.260644",
      "source": "realtime_capture"
    },
    {
      "type": "message",
      "content": "Now with grounded deeo understanding anf the work all along the way, please help me best commit this with precise accurate and technical and concise commit message that cover all points that we did he",
      "added_at": "2026-01-23T08:02:05.260668",
      "source": "realtime_capture"
    }
  ],
  "created_at": "2026-01-20T02:42:32.320251",
  "updated_at": "2026-01-23T08:02:05.260670"
}