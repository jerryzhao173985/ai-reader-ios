{
  "memories": [
    {
      "type": "preference",
      "content": "Build/test on physical iPhone 15 Pro Max via WiFi (Device ID: 00008130-001659882E43001C). User prefers complete, defensively correct code over minimal code if it aids maintainer understanding.",
      "added_at": "2026-01-20T07:20:00.000000"
    },
    {
      "type": "completed_feature",
      "content": "AIReaderApp: iOS EPUB reader with SwiftUI, SwiftData, WKWebView. Features: Library, TOC navigation, reading progress, text highlights with AI analysis (fact-check, discussion, key points, argument map, counterpoints, custom questions), inline side note markers [1][2][3], delete highlight via ellipsis menu + quick action button. GitHub: https://github.com/jerryzhao173985/ai-reader-ios",
      "added_at": "2026-01-21T21:00:00.000000"
    },
    {
      "type": "technical",
      "content": "SwiftData requires explicit modelContext.insert() for ALL related objects. EPUB spine includes front matter - findFirstContentChapter() skips items with <500 chars plainText.",
      "added_at": "2026-01-20T08:01:00.000000"
    },
    {
      "type": "technical",
      "content": "WKWebView architecture: JS injection for marker/color updates (not loadHTMLString to avoid flicker). Dual hash tracking (baseContentHash, styledContentHash). Selection preservation via hasActiveTextSelection flag + pendingMarkerUpdatesQueue. Scroll preservation: pendingScrollPosition NOT cleared after restoration, only on user manual scroll (scrollViewWillBeginDragging). Marker offset drift fix: isMarkerTextNode() + getTextOffset boundary snapping.",
      "added_at": "2026-01-22T00:20:00.000000"
    },
    {
      "type": "decision",
      "content": "AI analysis runs in background. Panel only opens when tapping inline side note marker [1][2][3], not automatically after analysis completes. Marker click handler: traverse up to parent highlight-{uuid} span (markers have highlight-marker-N class). injectMarkerUpdate() creates .analysis-marker but HTML reload overwrites it - effectively dead code.",
      "added_at": "2026-01-22T00:20:00.000000"
    },
    {
      "type": "decision",
      "content": "Delete highlight: reset ALL 4 selection-related states (selectedHighlight, analysisResult, isAnalyzing, showingAnalysisPanel) for complete state cleanup and symmetry with selectHighlight(). These form a logical unit - clearing partially creates implicit dependencies.",
      "added_at": "2026-01-22T00:20:00.000000"
    }
  ],
  "manual_memories": [],
  "realtime_memories": [
    {
      "type": "claude_response",
      "content": "Memory consolidated: 11 → 6 entries. Removed conversation fragments, merged WKWebView patterns, added today's insights about dead code and state management philosophy.",
      "added_at": "2026-01-22T00:23:19.011128",
      "source": "realtime_capture"
    },
    {
      "type": "message",
      "content": "Look thoroughly on this because previous session you did thuis which seems to have some logical ideas in it and seems to be something to improve: ❯ the thing is that not necessarily saying minimal is ",
      "added_at": "2026-01-22T00:23:19.011302",
      "source": "realtime_capture"
    },
    {
      "type": "claude_response",
      "content": "Done. Here's the complete summary:\n\n`★ Insight ─────────────────────────────────────`\n**The Proper Fix - Structural vs Visual Change Separation**\n\n**Before (Inefficient):**\n```\nanalysis completes\n  → ",
      "added_at": "2026-01-22T00:37:06.623958",
      "source": "realtime_capture"
    },
    {
      "type": "message",
      "content": "This is something I do not understand at all [N·count] if count > 1 for example I see art one place the side note shows [1·2] I was soconfused with middle dot, I was wondering if there are two exact s",
      "added_at": "2026-01-22T00:37:06.623978",
      "source": "realtime_capture"
    }
  ],
  "created_at": "2026-01-20T02:42:32.320251",
  "updated_at": "2026-01-22T00:37:06.623979"
}